trigger: none

# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/resources?view=azure-devops&tabs=schema
resources:
  pipelines:
  - pipeline: ciartifacts
    source: ci-artifacts
    trigger: 
      branches:
      - releases/*
  repositories:
  - repository: mdwdataops_adfpublish
    type: github
    endpoint: github_service_connection
    name: devlace/mdw-dataops-clone
    ref: adf_publish

stages:
- stage: deploy_to_stg
  displayName: 'Deploy to Stage'
  variables:
  - group: release_stg
  - group: keyvault_stg
  jobs: 
  - template: templates/jobs/deploy-databricks-job.yml
    parameters:
      environmentName: 'STG'
  - template: templates/jobs/deploy-azuresqldb-job.yml
    parameters:
      environmentName: 'STG'
      serviceConnection: 'azure_service_connection_stg'
  - template: templates/jobs/deploy-adf-job.yml
    parameters:
      environmentName: 'STG'
      serviceConnection: 'azure_service_connection_stg'

# - stage: deploy_to_prod
#   displayName: 'Deploy to Production'
#   variables:
#   - group: release_prod
#   - group: keyvault_prod
#   jobs: 
#   - template: templates/jobs/deploy-databricks-job.yml
#     parameters:
#       environmentName: 'PROD'
#   - template: templates/jobs/deploy-azuresqldb-job.yml
#     parameters:
#       environmentName: 'PROD' 
#       serviceConnection: 'TODO FILL ME UP'
#   - template: templates/jobs/deploy-adf-job.yml
#     parameters:
#       environmentName: 'PROD' 
#       serviceConnection: 'TODO FILL ME UP'
