{
  "customer_id": "customer_2",
  "adls_mount_path": "/mnt/non-timeseries",  
  "application_name": "fruit_app",
  "bad_data_storage_name": "bad_data",
  "checkpoint_name": "checkpoint",
  "serving_data_storage_path": "Serving",
  "event_data_storage_path": "Standard",
  "event_data_curation": [
    {
      "sql": "select m.ID, m.Fruit, sum(m.amount) as sales_count, sum(m.Price*m.amount) as sales_total from fruits_events_1 m group by m.ID, m.Fruit order by sales_total desc limit 3",
      "target": "fruits_sales_1",
      "partition_keys": ""
    },
    {
      "function": "cddp_fruit_app_customers.customer_2.event_data_curation",
      "target": "fruits_sales_2",
      "partition_keys": "ID"
    }    
  ],
  "event_data_source": [
    {
      "name": "event-hub",
      "type": "local",
      "format": "json",
      "table_name": "events_1",
      "schema": "cddp_fruit_app_customers.customer_2.event_data_schema",
      "timestamp_col": "ts",
      "partition_keys": "ID",
      "location": "customer_2/mock_events/events_1/"
    },
    {
      "name": "event-hub",
      "type": "local",
      "format": "json",
      "table_name": "events_2",
      "timestamp_col": "ts",
      "partition_keys": "ID",
      "location": "customer_2/mock_events/events_2/"
    }
  ],
  "event_data_transform": [
    {
      "sql": "\n select m.ID, m.Fruit, m.Price, e.amount, e.ts, e.rz_create_ts, e.lz_filename from events_1 e\n left outer join fruits_1 m\n ON e.id=m.ID \n and m.row_active_start_ts<=e.ts\n and m.row_active_end_ts>e.ts\n ",
      "target": "fruits_events_1",
      "timestamp_col": "ts",
      "storage_path": "Standard",
      "partition_keys": "ID"
    },
    {
      "function": "cddp_fruit_app_customers.customer_2.event_transformation",
      "source": "events_2",
      "target": "fruits_events_2",
      "timestamp_col": "ts",
      "storage_path": "Standard",
      "partition_keys": ""
    }
  ],
  "staging_data_storage_path": "Staging",
  "master_data_source": [
    {
      "name": "raw_data_1",
      "type": "csv",
      "schema": "cddp_fruit_app_customers.customer_2.raw_data_schema",
      "data": "ID,shuiguo,yanse,jiage\n1,Red Grape,Red,2.5\n2,Peach,Yellow,3.5\n3,Orange,Orange,2.3\n4,Green Apple,Green,3.5\n5,Fiji Apple,Red,3.4 \n6,Banana,Yellow,1.2\n7,Green Grape,Green,2.2",
      "table_name": "raw_fruits_1",
      "partition_keys": "",
      "key_cols": "ID"
    },
    {
      "name": "raw_data_2",
      "type": "csv-file",
      "schema": "cddp_fruit_app_customers.customer_2.raw_data_schema",
      "location": "customer_2/master_data/fruits.csv",
      "table_name": "raw_fruits_2",
      "partition_keys": "ID",
      "key_cols": "ID"
    },
    {
      "name": "raw_data_3",
      "type": "parquet",
      "schema": "cddp_fruit_app_customers.customer_2.raw_data_schema",
      "location": "customer_2/master_data/fruits.parquet",
      "table_name": "raw_fruits_3",
      "partition_keys": "",
      "key_cols": "ID"
    }
  ],
  "master_data_storage_path": "Standard",
  "master_data_transform": [
    {
      "sql": "SELECT rz_create_ts, lz_filename, md5_hash, ID, shuiguo as Fruit, yanse as Colour, jiage as Price FROM raw_fruits_1",
      "replay-sql": "SELECT ID, shuiguo as Fruit, jiage + 10 as Price, yanse as Colour, md5_hash, rz_create_ts as row_active_start_ts,LAG(rz_create_ts, -1, cast('9999-12-31 00:00:00.000000+00:00' as timestamp)) OVER(PARTITION BY md5_hash ORDER BY md5_hash, rz_create_ts) AS row_active_end_ts FROM raw_fruits_1",
      "replay-pre-check": "cddp_fruit_app_customers.customer_2.master_data_replay_pre_check",
      "target": "fruits_1",
      "partition_keys": "ID,Fruit",
      "key_cols": "ID",
      "mandatory_cols": "row_active_start_ts,row_active_end_ts"
    },
    {
      "function": "cddp_fruit_app_customers.customer_2.master_transformation",
      "target": "fruits_2"
    },
    {
      "sql": "SELECT rz_create_ts, lz_filename, md5_hash, ID, shuiguo as Fruit, yanse as Colour, jiage as Price FROM raw_fruits_3",
      "replay-sql": "SELECT ID, shuiguo as Fruit, jiage + 10 as Price, yanse as Colour, md5_hash, rz_create_ts as row_active_start_ts,LAG(rz_create_ts, -1, cast('9999-12-31 00:00:00.000000+00:00' as timestamp)) OVER(PARTITION BY md5_hash ORDER BY md5_hash, rz_create_ts) AS row_active_end_ts FROM raw_fruits_3",
      "target": "fruits_3",
      "partition_keys": "",
      "key_cols": "ID",
      "mandatory_cols": "row_active_start_ts,row_active_end_ts"
    }
  ],
  "master_data_curation": [
    {
      "sql": "select ID, Fruit, Colour, Price from fruits_1 where Colour='Green'",
      "target": "green_fruits_1",
      "partition_keys": "ID"
    },
    {
      "function": "cddp_fruit_app_customers.customer_2.master_curation",
      "target": "green_fruits_2"
    }
  ],
  "export_target_type": "csv",
  "export_file_name": "fruits",
  "export_data_storage_csv_path": "Exported"
}