trigger:
  branches:
    include:
      - dev
      - stg
      - prod
  paths:
    exclude:
      - fabric/workspace
      - devops

pr: none

stages:
  - stage: publish_dev_artifacts
    displayName: 'Publish artifacts for development environment'
    condition: |
      eq(variables['Build.SourceBranchName'], 'dev')
    variables:
      - group: vg-naganfabric8-dev
    jobs:
      - template: templates/jobs/publish-adls-artifacts.yml
        parameters:
          serviceConnection: sc-naganfabric8-dev
      - template: templates/jobs/publish-fabric-env-artifacts.yml

  - stage: publish_stg_artifacts
    displayName: 'Publish artifacts for staging environment'
    condition: |
      eq(variables['Build.SourceBranchName'], 'stg')
    variables:
      - group: vg-naganfabric8-stg
    jobs:
      - template: templates/jobs/publish-adls-artifacts.yml
        parameters:
          serviceConnection: sc-naganfabric8-stg
      - template: templates/jobs/publish-fabric-env-artifacts.yml

  - stage: publish_prod_artifacts
    displayName: 'Publish artifacts for production environment'
    condition: |
      eq(variables['Build.SourceBranchName'], 'prod')
    variables:
      - group: vg-naganfabric8-prod
    jobs:
      - template: templates/jobs/publish-adls-artifacts.yml
        parameters:
          serviceConnection: sc-naganfabric8-prod
      - template: templates/jobs/publish-fabric-env-artifacts.yml
